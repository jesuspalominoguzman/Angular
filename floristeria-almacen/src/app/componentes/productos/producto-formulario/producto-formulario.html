<div class="modal-backdrop" (click)="cerrar()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2 class="modal-title">{{ titulo() }}</h2>
            <button class="btn-close" (click)="cerrar()" title="Cerrar">✕</button>
        </div>

        <form [formGroup]="formulario" (ngSubmit)="guardar()" class="modal-body">
            <div class="form-group">
                <label for="nombre">Nombre del Producto *</label>
                <input type="text" id="nombre" formControlName="nombre" class="form-control"
                    [class.error]="nombre?.invalid && nombre?.touched" placeholder="Ej: Rosa Roja">
                @if (nombre?.invalid && nombre?.touched) {
                <div class="error-message">
                    @if (nombre?.errors?.['required']) {
                    El nombre es obligatorio
                    }
                    @if (nombre?.errors?.['minlength']) {
                    El nombre debe tener al menos 3 caracteres
                    }
                </div>
                }
            </div>

            <div class="form-group">
                <label for="categoria">Categoría *</label>
                <select id="categoria" formControlName="categoria" class="form-control"
                    [class.error]="categoria?.invalid && categoria?.touched">
                    <option value="">Seleccionar categoría</option>
                    <option value="Flores">Flores</option>
                    <option value="Macetas">Macetas</option>
                    <option value="Abonos">Abonos</option>
                    <option value="Herramientas">Herramientas</option>
                    <option value="Decoración">Decoración</option>
                </select>
                @if (categoria?.invalid && categoria?.touched) {
                <div class="error-message">
                    La categoría es obligatoria
                </div>
                }
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="precioCompra">Precio de Compra (€) *</label>
                    <input type="number" id="precioCompra" formControlName="precioCompra" class="form-control"
                        [class.error]="precioCompra?.invalid && precioCompra?.touched" step="0.01" min="0"
                        placeholder="0.00">
                    @if (precioCompra?.invalid && precioCompra?.touched) {
                    <div class="error-message">
                        El precio debe ser mayor o igual a 0
                    </div>
                    }
                </div>

                <div class="form-group">
                    <label for="precioVenta">Precio de Venta (€) *</label>
                    <input type="number" id="precioVenta" formControlName="precioVenta" class="form-control"
                        [class.error]="precioVenta?.invalid && precioVenta?.touched" step="0.01" min="0"
                        placeholder="0.00">
                    @if (precioVenta?.invalid && precioVenta?.touched) {
                    <div class="error-message">
                        El precio debe ser mayor o igual a 0
                    </div>
                    }
                </div>
            </div>

            <div class="form-group">
                <label for="stock">Stock Inicial (unidades) *</label>
                <input type="number" id="stock" formControlName="stock" class="form-control"
                    [class.error]="stock?.invalid && stock?.touched" min="0" placeholder="0">
                @if (stock?.invalid && stock?.touched) {
                <div class="error-message">
                    El stock debe ser mayor o igual a 0
                </div>
                }
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-secondary" (click)="cerrar()">
                    Cancelar
                </button>
                <button type="submit" class="btn-primary" [disabled]="formulario.invalid">
                    {{ producto() ? 'Actualizar' : 'Guardar' }}
                </button>
            </div>
        </form>
    </div>
</div>